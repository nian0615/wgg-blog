<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用 Mongo DB 教程记录 | 王果果 の博客</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/wgg-blog/flower.ico">
    <meta name="description" content="王果果的博客">
    <link rel="preload" href="/wgg-blog/assets/css/0.styles.d238acda.css" as="style"><link rel="preload" href="/wgg-blog/assets/js/app.ca45e25c.js" as="script"><link rel="preload" href="/wgg-blog/assets/js/2.8fc15104.js" as="script"><link rel="preload" href="/wgg-blog/assets/js/12.26081e86.js" as="script"><link rel="prefetch" href="/wgg-blog/assets/js/10.9cf5d783.js"><link rel="prefetch" href="/wgg-blog/assets/js/11.c2509bec.js"><link rel="prefetch" href="/wgg-blog/assets/js/13.54782f8e.js"><link rel="prefetch" href="/wgg-blog/assets/js/14.b8a24311.js"><link rel="prefetch" href="/wgg-blog/assets/js/15.b54c8932.js"><link rel="prefetch" href="/wgg-blog/assets/js/16.0fe33668.js"><link rel="prefetch" href="/wgg-blog/assets/js/17.7e87af5e.js"><link rel="prefetch" href="/wgg-blog/assets/js/18.a6b7936f.js"><link rel="prefetch" href="/wgg-blog/assets/js/19.168714ed.js"><link rel="prefetch" href="/wgg-blog/assets/js/20.a007de3e.js"><link rel="prefetch" href="/wgg-blog/assets/js/21.227d690b.js"><link rel="prefetch" href="/wgg-blog/assets/js/22.efa53d7c.js"><link rel="prefetch" href="/wgg-blog/assets/js/23.84045e27.js"><link rel="prefetch" href="/wgg-blog/assets/js/24.4bdb00f6.js"><link rel="prefetch" href="/wgg-blog/assets/js/25.7203e13a.js"><link rel="prefetch" href="/wgg-blog/assets/js/26.f4263ba9.js"><link rel="prefetch" href="/wgg-blog/assets/js/27.aca6ac29.js"><link rel="prefetch" href="/wgg-blog/assets/js/28.79f91f79.js"><link rel="prefetch" href="/wgg-blog/assets/js/29.081fd03d.js"><link rel="prefetch" href="/wgg-blog/assets/js/3.356568c5.js"><link rel="prefetch" href="/wgg-blog/assets/js/30.f5e2f02b.js"><link rel="prefetch" href="/wgg-blog/assets/js/31.660ddadb.js"><link rel="prefetch" href="/wgg-blog/assets/js/32.90917185.js"><link rel="prefetch" href="/wgg-blog/assets/js/33.4af979da.js"><link rel="prefetch" href="/wgg-blog/assets/js/34.1f3dee64.js"><link rel="prefetch" href="/wgg-blog/assets/js/35.4d648c21.js"><link rel="prefetch" href="/wgg-blog/assets/js/36.c151129b.js"><link rel="prefetch" href="/wgg-blog/assets/js/37.7ed0feaa.js"><link rel="prefetch" href="/wgg-blog/assets/js/38.6a5153b8.js"><link rel="prefetch" href="/wgg-blog/assets/js/39.15859c36.js"><link rel="prefetch" href="/wgg-blog/assets/js/4.4f895811.js"><link rel="prefetch" href="/wgg-blog/assets/js/40.bdd7eddc.js"><link rel="prefetch" href="/wgg-blog/assets/js/41.18ade10d.js"><link rel="prefetch" href="/wgg-blog/assets/js/42.2613648b.js"><link rel="prefetch" href="/wgg-blog/assets/js/43.ea4079bb.js"><link rel="prefetch" href="/wgg-blog/assets/js/44.79496308.js"><link rel="prefetch" href="/wgg-blog/assets/js/45.3dac2741.js"><link rel="prefetch" href="/wgg-blog/assets/js/46.4086de34.js"><link rel="prefetch" href="/wgg-blog/assets/js/47.12f4ffd9.js"><link rel="prefetch" href="/wgg-blog/assets/js/48.95490709.js"><link rel="prefetch" href="/wgg-blog/assets/js/49.e7fcb375.js"><link rel="prefetch" href="/wgg-blog/assets/js/5.4ab70980.js"><link rel="prefetch" href="/wgg-blog/assets/js/50.6dac2f5e.js"><link rel="prefetch" href="/wgg-blog/assets/js/51.c15de6e9.js"><link rel="prefetch" href="/wgg-blog/assets/js/52.9f8609ac.js"><link rel="prefetch" href="/wgg-blog/assets/js/53.acc92034.js"><link rel="prefetch" href="/wgg-blog/assets/js/54.517fbb9a.js"><link rel="prefetch" href="/wgg-blog/assets/js/55.90f625c0.js"><link rel="prefetch" href="/wgg-blog/assets/js/56.3ab1e459.js"><link rel="prefetch" href="/wgg-blog/assets/js/57.02883de2.js"><link rel="prefetch" href="/wgg-blog/assets/js/58.ea9d13f0.js"><link rel="prefetch" href="/wgg-blog/assets/js/59.63cf3a83.js"><link rel="prefetch" href="/wgg-blog/assets/js/6.0b41ddbd.js"><link rel="prefetch" href="/wgg-blog/assets/js/60.811fe401.js"><link rel="prefetch" href="/wgg-blog/assets/js/61.fb55b21a.js"><link rel="prefetch" href="/wgg-blog/assets/js/62.ae13b9a0.js"><link rel="prefetch" href="/wgg-blog/assets/js/63.6025fb1f.js"><link rel="prefetch" href="/wgg-blog/assets/js/64.c07f485c.js"><link rel="prefetch" href="/wgg-blog/assets/js/7.7f18774a.js"><link rel="prefetch" href="/wgg-blog/assets/js/8.eadcb74c.js"><link rel="prefetch" href="/wgg-blog/assets/js/9.5766ad28.js">
    <link rel="stylesheet" href="/wgg-blog/assets/css/0.styles.d238acda.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/wgg-blog/" class="home-link router-link-active"><!----> <span class="site-name">王果果 の博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/wgg-blog/blog/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/wgg-blog/interview/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="https://github.com/nian0615" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/wgg-blog/blog/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/wgg-blog/interview/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="https://github.com/nian0615" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Uniapp</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>数据库</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/wgg-blog/blog/DB/Learnmongodb.html" class="active sidebar-link">使用 Mongo DB 教程记录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/Learnmongodb.html#_1-安装及启动" class="sidebar-link">1.安装及启动</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/Learnmongodb.html#_2-mongo-基本命令-1" class="sidebar-link">2.Mongo 基本命令-1</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/Learnmongodb.html#_3-mongo-基本命令-2" class="sidebar-link">3.Mongo 基本命令-2</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/Learnmongodb.html#_4-用-js-文件写-mongo-命令" class="sidebar-link">4.用 js 文件写 mongo 命令</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/Learnmongodb.html#_5-批量插入的正确方法" class="sidebar-link">5.批量插入的正确方法</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/Learnmongodb.html#_6-修改：update-常见错误（最基本的，但是最易犯错的）" class="sidebar-link">6.修改：Update 常见错误（最基本的，但是最易犯错的）</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/Learnmongodb.html#_7-修改：初识-update-修改器" class="sidebar-link">7.修改：初识 update 修改器</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/Learnmongodb.html#_8-update-数组修改器" class="sidebar-link">8.update 数组修改器</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/Learnmongodb.html#_9-修改：状态返回与安全" class="sidebar-link">9.修改：状态返回与安全</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/Learnmongodb.html#_10-查询：find-的不等修饰符" class="sidebar-link">10.查询：find 的不等修饰符</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/Learnmongodb.html#_11-查询：find-的多条件查询" class="sidebar-link">11.查询：find 的多条件查询</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/Learnmongodb.html#_12-查询：find-的数组查询" class="sidebar-link">12.查询：find 的数组查询</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/Learnmongodb.html#_13-查询：find-的参数使用方法" class="sidebar-link">13.查询：find 的参数使用方法</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/Learnmongodb.html#_14-查询：find-如何在-js-文本中使用" class="sidebar-link">14.查询：find 如何在 js 文本中使用</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/Learnmongodb.html#_15-索引-构造百万级数据" class="sidebar-link">15.索引:构造百万级数据</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/Learnmongodb.html#_16-索引：索引入门" class="sidebar-link">16.索引：索引入门</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/Learnmongodb.html#_17-索引：复合索引" class="sidebar-link">17.索引：复合索引</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/Learnmongodb.html#_18-索引：全文索引" class="sidebar-link">18.索引：全文索引</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/Learnmongodb.html#_19-管理-用户的创建、删除与修改" class="sidebar-link">19.管理:用户的创建、删除与修改</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/Learnmongodb.html#_20-数据库的备份和还原" class="sidebar-link">20.数据库的备份和还原</a></li></ul></li><li><a href="/wgg-blog/blog/DB/koa.html" class="sidebar-link">Koa2 基本学习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/koa.html#koa-环境配置" class="sidebar-link">Koa 环境配置</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/koa.html#async-await-的使用方法" class="sidebar-link">async/await 的使用方法</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/koa.html#get-请求的接收" class="sidebar-link">Get 请求的接收</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/koa.html#post-请求如何接收以及转换成-json-的原理" class="sidebar-link">POST 请求如何接收以及转换成 json 的原理</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/koa.html#koa-bodyparser-中间件" class="sidebar-link">koa-bodyparser 中间件</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/koa.html#koa2-原生路由实现" class="sidebar-link">Koa2 原生路由实现</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/koa.html#koa-router-中间件（1）入门" class="sidebar-link">Koa-router 中间件（1）入门</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/koa.html#koa-router-中间件（2）层级" class="sidebar-link">Koa-router 中间件（2）层级</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/koa.html#koa-router-中间件（3）参数" class="sidebar-link">Koa-router 中间件（3）参数</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/koa.html#koa2-中使用-cookie" class="sidebar-link">Koa2 中使用 cookie</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/koa.html#koa2-的模板初识（ejs）" class="sidebar-link">Koa2 的模板初识（ejs）</a></li><li class="sidebar-sub-header"><a href="/wgg-blog/blog/DB/koa.html#koa-static-静态资源中间件" class="sidebar-link">koa-static 静态资源中间件</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="使用-mongo-db-教程记录"><a href="#使用-mongo-db-教程记录" class="header-anchor">#</a> 使用 Mongo DB 教程记录</h1> <blockquote><p>MongoDB 是非关系型数据库</p></blockquote> <h2 id="_1-安装及启动"><a href="#_1-安装及启动" class="header-anchor">#</a> 1.安装及启动</h2> <p>1.默认安装在 C 盘目录下，配置系统环境变量 --&gt;点击 Path--&gt;点击编辑</p> <p>--&gt;C:\Program Files\MongoDB\Server\4.2\bin--&gt;添加到变量中点击确定</p> <p>2.在 C 盘的根目录建立一个 data 文件夹，在 data 文件夹下建立一个 db 文件夹(一般是安装盘的根目录，建立 data/db,这两个文件夹)</p> <p>3.运行服务端--&gt;打开 cmd 输入命令 Mongod,这时候服务就可以开启了，链接默认端口是 27017。链接服务--&gt;再打开新命令，输入 mongo 【注意的是：在此过程中，mongod 这个命令中一定不要 ctr+c 否则会报错！！！！！因为这个操作关闭了服务器】如下图就是正确的</p> <img src="C:\Users\wang\Desktop\study\md\1585545792.jpg" style="zoom:150%;"> <p>4.在新打开的命令方输入 show dbs,可以知道有多少个数据库，再输入 db.version(),可以查看版本号</p> <h2 id="_2-mongo-基本命令-1"><a href="#_2-mongo-基本命令-1" class="header-anchor">#</a> 2.Mongo 基本命令-1</h2> <ul><li><p>打开 mongod 命令和 mongo 命令后，可以执行以下代码</p></li> <li><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">;</span>
<span class="token function">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 也可以输入函数</span>
<span class="token keyword">function</span> <span class="token function">wgg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&quot;wgg&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">wgg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>查看数据库输入的命令是 show dbs，windows 系统下默认三个数据库 admin config local 三个数据库，所以之后起名不要在重复起这三个的名字</p></li> <li><p>进入数据库的命令是 use admin</p></li> <li><p>显示数据库中的集合 show collections （关系型中叫表，我们要逐渐熟悉）</p></li> <li><p>查看自己所在的库 db [用得最多]</p></li></ul> <h2 id="_3-mongo-基本命令-2"><a href="#_3-mongo-基本命令-2" class="header-anchor">#</a> 3.Mongo 基本命令-2</h2> <p>use db（建立数据库）：use 不仅可以进入一个数据库，如果你敲入的库不存在，它还可以帮你建立一个库。但是在没有集合前，它还是默认为空</p> <p><strong>增加</strong> use user 建（一个名为 user 的）数据库 --&gt; db 查看 --&gt;show dbs 查看无 user 这个表 因为里面没有集合 --&gt; db.loo.insert({&quot;name&quot;:&quot;wgg&quot;}) [*db.集合.insert( ):新建数据集合和插入文件（数据），当集合没有时，这时候就可以新建一个集合，并向里边插入数据]*[loo 就相当于是 user 库里面的一个集合]</p> <p><strong>查看</strong> db.loo.find()查看 loo 这个集合里面的所有数据</p> <p>如果里面有很多条数据，想要查找第一条数据，遵循小驼峰命名法输入命令 db.loo.findOne()</p> <p><strong>修改</strong> 数据：例如修改第一条数据 db.loo.update({&quot;name&quot;:&quot;wgg&quot;},{&quot;name&quot;:&quot;wnn&quot;,&quot;age&quot;:&quot;18&quot;})，修改后查看到数据为{ &quot;_id&quot; : ObjectId(&quot;5e7da21d3b3fe14bb3b002c3&quot;), &quot;name&quot; : &quot;wnn&quot;, &quot;age&quot; : &quot;18&quot; }</p> <p><strong>删除</strong> 指定 loo 集合里的指定数据 db.loo.remove({&quot;name&quot;:&quot;wgg&quot;})</p> <p><strong>删除整个 user 库</strong> 1.执行命令 db.user.drop();控制台返回 true，再输入命令 show dbs 就没有这个 user 库 // 2.或者保证在 user 这个库下面 执行 db.dropDatabase()也可以删除整个库</p> <h2 id="_4-用-js-文件写-mongo-命令"><a href="#_4-用-js-文件写-mongo-命令" class="header-anchor">#</a> 4.用 js 文件写 mongo 命令</h2> <blockquote><p>一定一定要在 cmd 下面打开 mongod mongo 服务器，否则链接不成功，报错</p></blockquote> <ol><li><p>新建一个 js 文件，如下</p></li> <li><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> userName <span class="token operator">=</span> <span class="token string">&quot;wgg&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> time <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> jsonDatabase <span class="token operator">=</span> <span class="token punctuation">{</span> loginName<span class="token operator">:</span> userName<span class="token punctuation">,</span> loginTime<span class="token operator">:</span> time <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;log&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建库名为log  此处声明db必须是var 不能用let 前面的声明可以用let 可能是mongo DB 对es6语法的支持不够  所以建议都用var</span>
db<span class="token punctuation">.</span>login<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>jsonDatabase<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 新建了一个login集合在log库里面</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;successful&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>再在终端输入命令 mongo goTask.js（文件名），控制台就会打印 print 里面的信息</p></li> <li><p>在 cmd 中输入 show dbs 可查看到库</p></li> <li><p>如果新增数据的话，可以直接在终端继续执行命令 mongo goTask.js（文件名），再在 cmd 中查看，db.login.find()</p></li></ol> <h2 id="_5-批量插入的正确方法"><a href="#_5-批量插入的正确方法" class="header-anchor">#</a> 5.批量插入的正确方法</h2> <ol><li><p>cmd 中批量插入的话是用数组，如：db.loo.insert([{&quot;name&quot;:&quot;wgg&quot;},{&quot;name&quot;:&quot;wgg2&quot;},{&quot;name&quot;:&quot;wgg3&quot;}])</p></li> <li><p>做了如下对比，批量导入和循环导入的耗时计算，结果，批量导入是非常快的，性能也提高很多，代码如下</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始时间</span>
<span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;log&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 链接log数据库</span>

<span class="token comment">// 循环导入到数据库</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 446ms</span>
<span class="token punctuation">}</span>
<span class="token comment">// 批量到数据库中</span>
<span class="token keyword">let</span> temp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  temp<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> num<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token comment">// 20ms</span>
db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> end <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> time<span class="token punctuation">;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;scecc&quot;</span> <span class="token operator">+</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li></ol> <h2 id="_6-修改：update-常见错误（最基本的，但是最易犯错的）"><a href="#_6-修改：update-常见错误（最基本的，但是最易犯错的）" class="header-anchor">#</a> 6.修改：Update 常见错误（最基本的，但是最易犯错的）</h2> <blockquote><p>在 vscode 可以执行命令 mongo demo2.js（文件名）,再在 cmd 里面查看命令；也可以在 vscode 的终端执行命令 mongo,然后 load('./demo.js'),之后在终端就可以执行 mongo 命令了，show dbs 也可以查看库了</p></blockquote> <ol><li><p>新建一个 demo.js 代码如下</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> work1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;wgg&quot;</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token string">&quot;20&quot;</span><span class="token punctuation">,</span>
  sex<span class="token operator">:</span> <span class="token string">&quot;女&quot;</span><span class="token punctuation">,</span>
  job<span class="token operator">:</span> <span class="token string">&quot;web&quot;</span><span class="token punctuation">,</span>
  skill<span class="token operator">:</span> <span class="token punctuation">{</span>
    one<span class="token operator">:</span> <span class="token string">&quot;html&quot;</span><span class="token punctuation">,</span>
    two<span class="token operator">:</span> <span class="token string">&quot;css&quot;</span><span class="token punctuation">,</span>
    three<span class="token operator">:</span> <span class="token string">&quot;js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  reginedTime<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> work2 <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;wnn&quot;</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token string">&quot;21&quot;</span><span class="token punctuation">,</span>
  sex<span class="token operator">:</span> <span class="token string">&quot;女&quot;</span><span class="token punctuation">,</span>
  job<span class="token operator">:</span> <span class="token string">&quot;web1&quot;</span><span class="token punctuation">,</span>
  skill<span class="token operator">:</span> <span class="token punctuation">{</span>
    one<span class="token operator">:</span> <span class="token string">&quot;html1&quot;</span><span class="token punctuation">,</span>
    two<span class="token operator">:</span> <span class="token string">&quot;css1&quot;</span><span class="token punctuation">,</span>
    three<span class="token operator">:</span> <span class="token string">&quot;js1&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  reginedTime<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> work3 <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;wzq&quot;</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token string">&quot;23&quot;</span><span class="token punctuation">,</span>
  sex<span class="token operator">:</span> <span class="token string">&quot;男&quot;</span><span class="token punctuation">,</span>
  job<span class="token operator">:</span> <span class="token string">&quot;web2&quot;</span><span class="token punctuation">,</span>
  skill<span class="token operator">:</span> <span class="token punctuation">{</span>
    one<span class="token operator">:</span> <span class="token string">&quot;html2&quot;</span><span class="token punctuation">,</span>
    two<span class="token operator">:</span> <span class="token string">&quot;css2&quot;</span><span class="token punctuation">,</span>
    three<span class="token operator">:</span> <span class="token string">&quot;js2&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  reginedTime<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;company&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> workMat <span class="token operator">=</span> <span class="token punctuation">[</span>work1<span class="token punctuation">,</span> work2<span class="token punctuation">,</span> work3<span class="token punctuation">]</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>workMat<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 插入到workmet的集合里</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div></li> <li><p>如想修改 work3 里面的数据，就得新建一个 demo2.js 代码如下</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;company&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> work3 <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;wzq&quot;</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token string">&quot;4&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 修改</span>
  sex<span class="token operator">:</span> <span class="token string">&quot;女&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 修改</span>
  job<span class="token operator">:</span> <span class="token string">&quot;web2&quot;</span><span class="token punctuation">,</span>
  skill<span class="token operator">:</span> <span class="token punctuation">{</span>
    one<span class="token operator">:</span> <span class="token string">&quot;html2&quot;</span><span class="token punctuation">,</span>
    two<span class="token operator">:</span> <span class="token string">&quot;css2&quot;</span><span class="token punctuation">,</span>
    three<span class="token operator">:</span> <span class="token string">&quot;js2&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  reginedTime<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;wzq&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> work3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li> <li><p>这时候你需要删除（db.workmate.drop()）表中的数据，因为 wzq 这个用户已经不在数据库中了，然后重新使用 load 方法载入插入数据再进行修改</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//执行命令如下:</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;./demo.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;./demo2.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>执行上面的命令后，db.workmet.find()查看数据库正常</p></li></ol> <h2 id="_7-修改：初识-update-修改器"><a href="#_7-修改：初识-update-修改器" class="header-anchor">#</a> 7.修改：初识 update 修改器</h2> <ol><li><h6 id="set-还是第六节下面的原始代码，新建一个-demo2-js-代码如下-使用-set-修改，在控制台执行-load-demo2-js-再执行-db-workmet-find-查看集合，修改成功"><a href="#set-还是第六节下面的原始代码，新建一个-demo2-js-代码如下-使用-set-修改，在控制台执行-load-demo2-js-再执行-db-workmet-find-查看集合，修改成功" class="header-anchor">#</a> <strong>$set</strong> 还是第六节下面的原始代码，新建一个 demo2.js,代码如下,使用**$set**修改，在控制台执行 load(&quot;./demo2.js&quot;),再执行 db.workmet.find(),查看集合，修改成功</h6> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;company&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;wzq&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;yxw22&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token string">&quot;56&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>修改嵌套数据，代码如下：在控制台执行命令 load('./demo2.js')--&gt;db.workmet.find()可查看数据修改成功</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;company&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注意的是上面的操作已经将名字改成了yxw22,所以这里也要改名字的键值，否则修改不成功</span>
db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;yxw22&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;skill.one&quot;</span><span class="token operator">:</span> <span class="token string">&quot;PPt&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p><strong>$unset</strong> 若想隐藏某个字段或者删除，执行如下命令</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;yxw22&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $unset<span class="token operator">:</span> <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以填空值或者其他值，unset只关注key值</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;yxw22&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token operator">:</span> <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token string">&quot;23&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  age加回去  但是age的位置放在最后了，不再是原来的name下面了</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p><strong>$inc 对数字进行计算</strong>,它是对 value 值的修改，但是<u>修改的必须是数字，字符串是不起效果的</u>。我们现在要对 yxw22 的年龄减去 2 岁，就可以直接用$inc 来操作。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;yxw22&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $inc<span class="token operator">:</span> <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><strong>multi</strong> 假如要给<strong>每个</strong>人都添加一个兴趣属性，则要配合$set 属性，代码如下：（修改所有的值的时候或者添加项的时候均可使用此方法）</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token operator">:</span> <span class="token punctuation">{</span> interset<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> multi<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注意的是，第一个括号为空，第二个括号为新增的变量，可以是数组也可以是字符，第三个变量multi默认为false,只给第一组添加这个属性，所以要将它修改为true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><strong>upsert</strong>查找指定值，有就修改，没有就添加，默认为 false(没有不作任何操作),若为 true，则会对数据库查找，有此值，则修改，没有此值，则添加，代码如下</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;yxw22&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token operator">:</span> <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token number">16</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> upsert<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 修改yxw22的年龄为16</span>
db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;xiaowang&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token operator">:</span> <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token number">16</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> upsert<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 新增了一个叫xiaowang的年龄为16的数据</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ol> <h2 id="_8-update-数组修改器"><a href="#_8-update-数组修改器" class="header-anchor">#</a> 8.update 数组修改器</h2> <h5 id="push-追加数组-内嵌文档值"><a href="#push-追加数组-内嵌文档值" class="header-anchor">#</a> $push 追加数组/内嵌文档值</h5> <blockquote><p>注意的是，数据库里必须有这个数据，否则不成功，执行 upsert 操作后，再执行此操作</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;xiaowang&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $push<span class="token operator">:</span> <span class="token punctuation">{</span> inserts<span class="token operator">:</span> <span class="token string">&quot;sing&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 新增技能  看（6.1里面的代码）</span>
db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;wzq&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $push<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;skill.four&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sing&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="ne-查找是否存在（没有则修改，有则不修改。）"><a href="#ne-查找是否存在（没有则修改，有则不修改。）" class="header-anchor">#</a> <strong>$ne 查找是否存在</strong>（<strong>没有则修改，有则不修改。</strong>）</h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 查找 小王的inserts 属性里面有没有 game这个字段，有就不管  没有就添加PlayGame这个字段</span>
db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;xiaowang&quot;</span><span class="token punctuation">,</span> inserts<span class="token operator">:</span> <span class="token punctuation">{</span> $ne<span class="token operator">:</span> <span class="token string">&quot;game&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> $push<span class="token operator">:</span> <span class="token punctuation">{</span> inserts<span class="token operator">:</span> <span class="token string">&quot;PlayGame&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 结果</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5e7f38ce546411839bfcbfea&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;xiaowang&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">&quot;inserts&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;sing&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;PlayGame&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="addtoset（s也要大写）-升级版的-ne"><a href="#addtoset（s也要大写）-升级版的-ne" class="header-anchor">#</a> <strong>$addToSet（s也要大写） 升级版的$ne</strong></h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;xiaowang&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $addToSet<span class="token operator">:</span> <span class="token punctuation">{</span> inserts<span class="token operator">:</span> <span class="token string">&quot;draw&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="each-批量追加"><a href="#each-批量追加" class="header-anchor">#</a> <strong>$each 批量追加</strong></h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> newSkill <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;sing&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dance&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;play&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;xiaowang&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> $addToSet<span class="token operator">:</span> <span class="token punctuation">{</span> inserts<span class="token operator">:</span> <span class="token punctuation">{</span> $each<span class="token operator">:</span> newSkill <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token comment">// 通常和$addToSet 一起合用  代表追加中 有的则不管  没有的则追加</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="pop-删除数组值"><a href="#pop-删除数组值" class="header-anchor">#</a> <strong>$pop 删除数组值</strong></h5> <p>$pop 只删除一次，并不是删除所有数组中的值。而且它有两个选项，一个是 1 和-1。</p> <ul><li>1：从数组末端进行删除</li> <li>-1：从数组开端进行删除</li></ul> <p>例子：现在要删除 xiaoWang 的编码爱好（code）。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;xiaoWang&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $pop<span class="token operator">:</span> <span class="token punctuation">{</span> interest<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="数组定位修改"><a href="#数组定位修改" class="header-anchor">#</a> <strong>数组定位修改</strong></h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;xiaowang&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;inserts.1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;game&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// inserts数组 .1 是数组里面想要修改的值的下标  &quot;game&quot;想要从原来的值修改成game</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_9-修改：状态返回与安全"><a href="#_9-修改：状态返回与安全" class="header-anchor">#</a> 9.修改：状态返回与安全</h2> <h5 id="db-runcommand"><a href="#db-runcommand" class="header-anchor">#</a> <strong>db.runCommand( )</strong></h5> <p>它是数据库运行命令的执行器，执行命令首选就要使用它，因为它在 Shell 和驱动程序间提供了一致的接口。（几乎操作数据库的所有操作，都可以使用 runCommand 来执行）现在我们试着用 runCommand 来修改数据库，看看结果和直接用 db.collections.update（非应答式操作）有什么不同。</p> <ul><li>false：第一句末尾的 false 是 upsert 的简写，代表没有此条数据时不增加;</li> <li>true：true 是 multi 的简写，代表修改所有。</li> <li>getLastError:1 :表示返回功能错误，这里的参数很多。</li> <li>printjson：表示以 json 对象的格式输出到控制台。</li> <li>db.listCommands( ):查看所有的 Commad 命令，内容很多</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 查找 sex 为男的条件</span>
db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> sex<span class="token operator">:</span> <span class="token string">&quot;男&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token operator">:</span> <span class="token punctuation">{</span> money<span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false占得位置是upsert 代表数据库中若没有  也不进行添加  true占的位置是multi 查找每个为男  并且都进行修改</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">runCommand</span><span class="token punctuation">(</span><span class="token punctuation">{</span> getLastError<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// getLastError表示返回功能性错误</span>
<span class="token comment">// 也可以这样写条件语句</span>
<span class="token comment">/* if (result.updatedExisting) {
} else {
} */</span>
<span class="token function">printjson</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 让打印出来是json格式  主要看的是updatedExisting这个值</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>db.runCommand({ping:1}) 控制台输入这个命令 可以知道是否连接成功 控制台返回{ &quot;ok&quot; : 1 }</p></blockquote> <h5 id="findandmodify"><a href="#findandmodify" class="header-anchor">#</a> <strong>findAndModify</strong></h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> mar <span class="token operator">=</span> <span class="token punctuation">{</span>
  findAndModify<span class="token operator">:</span> <span class="token string">&quot;workmet&quot;</span><span class="token punctuation">,</span> <span class="token comment">// workmet 集合</span>
  query<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;wgg&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 查找wgg的键值</span>
  update<span class="token operator">:</span> <span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token operator">:</span> <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 修改年龄为18</span>
  <span class="token keyword">new</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//更新完成，需要查看结果，如果为false不进行查看结果</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">runCommand</span><span class="token punctuation">(</span>mar<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printjson</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 让打印出来是json格式  主要看的是updatedExisting这个值</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>findAndModify 的性能是没有直接使用 db.collections.update 的性能好，但是在实际工作中都是使用它，毕竟要商用的程序安全性还是比较重要的。工作中尽量使用 findAndModify 来进行更新数据，这样会更安全和直观，这点性能的损失是值得的。</p></blockquote> <h5 id="findandmodify-属性值"><a href="#findandmodify-属性值" class="header-anchor">#</a> <strong>findAndModify 属性值</strong></h5> <blockquote><p>remove 和 update 两个参数只能有一个</p></blockquote> <ul><li>query：需要查询的条件/文档</li> <li>sort: 进行排序</li> <li>remove：[boolean]是否删除查找到的文档，值填写 true，可以删除。</li> <li>new:[boolean]返回更新前的文档还是更新后的文档。</li> <li>fields：需要返回的字段</li> <li>upsert：没有这个值是否增加。</li></ul> <h2 id="_10-查询：find-的不等修饰符"><a href="#_10-查询：find-的不等修饰符" class="header-anchor">#</a> 10.查询：find 的不等修饰符</h2> <p>想要查询指定数据，在控制台输入</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;skill.one&quot;</span><span class="token operator">:</span> <span class="token string">&quot;html&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以查找到 skill.one 的技能为 html 的所有人员的信息，若只想显示名字和技能则可以执行下面的代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> <span class="token string">&quot;skill.one&quot;</span><span class="token operator">:</span> <span class="token string">&quot;html&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;skill.one&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> _id<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token comment">// true 1 都是显示的意思  0 false 都是不显示的意思</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="不等修饰符"><a href="#不等修饰符" class="header-anchor">#</a> <strong>不等修饰符</strong></h5> <ul><li>小于($lt):英文全称 less-than</li> <li>小于等于($lte)：英文全称 less-than-equal</li> <li>大于($gt):英文全称 greater-than</li> <li>大于等于($gte):英文全称 greater-than-equal</li> <li>不等于($ne):英文全称 not-equal 我们现在要查找一下，公司内年龄小于 30 大于 25 岁的人员。看下面的代码。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 查找age小于等于30 大于23的信息</span>
db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token punctuation">{</span> $lte<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> $gte<span class="token operator">:</span> <span class="token number">23</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;skill.one&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> _id<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_11-查询：find-的多条件查询"><a href="#_11-查询：find-的多条件查询" class="header-anchor">#</a> 11.查询：find 的多条件查询</h2> <h5 id="in-修饰符"><a href="#in-修饰符" class="header-anchor">#</a> <strong>$in 修饰符</strong></h5> <p>in 修饰符可以轻松解决一键多值的查询情况</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 查询年龄大于等于20 小于等于23的人的信息</span>
db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token punctuation">{</span> $<span class="token keyword">in</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;skill.one&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> _id<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 向对应的  不是20 到23 之间的人的信息</span>
db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token punctuation">{</span> $nin<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;skill.one&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> _id<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="or-修饰符"><a href="#or-修饰符" class="header-anchor">#</a> <strong>$or 修饰符</strong></h5> <p>它用来查询多个键值的情况，就比如查询同事中大于 30 岁或者会做 PHP 的信息。主要区别是两个 Key 值。$in 修饰符是一个 Key 值，这个需要去比较记忆。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 查询年龄大于23 或者技能第三项是写PHP的  相对应的有$nor</span>
db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> $or<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">23</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">&quot;skill.three&quot;</span><span class="token operator">:</span> <span class="token string">&quot;PHP&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;skill.three&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> _id<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="and-修饰符"><a href="#and-修饰符" class="header-anchor">#</a> <strong>$and 修饰符</strong></h5> <p>$and 用来查找几个 key 值都满足的情况，比如要查询同事中大于 30 岁并且会做 PHP 的信息，这时需要注意的是这两项必须全部满足。当然写法还是比较简单的。只要把上面代码中的 or 换成 and 就可以了。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 查询年龄大于23并且技能第三项是写PHP的  相对应的有$nor</span>
db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> $and<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">23</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">&quot;skill.three&quot;</span><span class="token operator">:</span> <span class="token string">&quot;PHP&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;skill.three&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> _id<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="not-修饰符"><a href="#not-修饰符" class="header-anchor">#</a> <strong>$not 修饰符</strong></h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 年龄除了大于20小于25的所有人的信息</span>
db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token punctuation">{</span> $not<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> $lt<span class="token operator">:</span> <span class="token number">25</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;skill.three&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> _id<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_12-查询：find-的数组查询"><a href="#_12-查询：find-的数组查询" class="header-anchor">#</a> 12.查询：find 的数组查询</h2> <h5 id="基本数组查询"><a href="#基本数组查询" class="header-anchor">#</a> <strong>基本数组查询</strong></h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> interest<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;玩游戏&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;美食&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;篮球&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    interest<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    _id<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 查找 interest: [&quot;玩游戏&quot;, &quot;美食&quot;, &quot;篮球&quot;] 这个条件的人</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>如果只知道某一个条件，如何查找</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> interest<span class="token operator">:</span> <span class="token string">&quot;画画&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    interest<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    _id<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//   { interest: &quot;画画&quot; }  这个地方里面不能写成   { interest:[ &quot;画画&quot; ]},中括号[]就相当于完全匹配</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="all-数组多项查询"><a href="#all-数组多项查询" class="header-anchor">#</a> <strong>$all-数组多项查询</strong></h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 查找 interest 满足画画和写代码两个条件的</span>
db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> interest<span class="token operator">:</span> <span class="token punctuation">{</span> $all<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;画画&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;写代码&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    interest<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    _id<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="in-数组的或者查询"><a href="#in-数组的或者查询" class="header-anchor">#</a> <strong>$in-数组的或者查询</strong></h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> interest<span class="token operator">:</span> <span class="token punctuation">{</span> $<span class="token keyword">in</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;看电影&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;看书&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> interest<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> _id<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 查找满足任意一项的或者两个都满足的就可以</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="size-数组个数查询"><a href="#size-数组个数查询" class="header-anchor">#</a> <strong>$size-数组个数查询</strong></h5> <p><strong>size 个数</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> interest<span class="token operator">:</span> <span class="token punctuation">{</span> $size<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    interest<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    _id<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 查找兴趣个数是 5 的条件</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="slice-显示选项"><a href="#slice-显示选项" class="header-anchor">#</a> <strong>$slice-显示选项</strong></h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> interest<span class="token operator">:</span> <span class="token punctuation">{</span> $size<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    interest<span class="token operator">:</span> <span class="token punctuation">{</span> $slice<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    _id<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// $slice  表示显示出来的结果interest只显示第一个 2则表示第二个 -1 则表示最后一个  { &quot;name&quot; : &quot;LiJia&quot;, &quot;age&quot; : 26, &quot;interest&quot; : [ &quot;玩游戏&quot; ] }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="_13-查询：find-的参数使用方法"><a href="#_13-查询：find-的参数使用方法" class="header-anchor">#</a> 13.查询：find 的参数使用方法</h2> <h5 id="find-参数："><a href="#find-参数：" class="header-anchor">#</a> find 参数：</h5> <ul><li>query：这个就是查询条件，MongoDB 默认的第一个参数。</li> <li>fields：（返回内容）查询出来后显示的结果样式，可以用 true 和 false 控制是否显示。</li> <li>limit：返回的数量，后边跟数字，控制每次查询返回的结果数量。</li> <li>skip:跳过多少个显示，和 limit 结合可以实现分页。</li> <li>sort：排序方式，从小到大排序使用 1，从大到小排序使用-1。</li></ul> <h5 id="分页-demo"><a href="#分页-demo" class="header-anchor">#</a> <strong>分页 Demo</strong></h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>workmet
  <span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> _id<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 按照每页两个显示limit(2)  skip(2)跳过2条数据 sort({ age: 1 }) 按照年龄从小到大的排序</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="where-修饰符"><a href="#where-修饰符" class="header-anchor">#</a> <strong>$where 修饰符</strong></h5> <p>它是一个非常强大的修饰符，但强大的背后也意味着有风险存在。它可以让我们在条件里使用 javascript 的方法来进行复杂查询。我们先来看一个最简单的例子，现在要查询年龄大于 30 岁的人员。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> $where<span class="token operator">:</span> <span class="token string">&quot;this.age&gt;30&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 条件得加上引号</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> _id<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这里的 this 指向的是 workmate（查询集合）本身。这样我们就可以在程序中随意调用。虽然强大和灵活，但是这种查询对于数据库的压力和安全性都会变重，所以在工作中尽量减少$where 修饰符的使用。</p> <h2 id="_14-查询：find-如何在-js-文本中使用"><a href="#_14-查询：find-如何在-js-文本中使用" class="header-anchor">#</a> 14.查询：find 如何在 js 文本中使用</h2> <h5 id="hasnext-循环结果"><a href="#hasnext-循环结果" class="header-anchor">#</a> <strong>hasNext 循环结果</strong></h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;company&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//进行链接对应的集合collections</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//声明变量result，并把查询结果赋值给result</span>
<span class="token comment">//利用游标的hasNext()进行循环输出结果。</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">printjson</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用json格式打印结果</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>再在控制台直接加载这个文件即可（load('./demmo6.js')</p> <h5 id="foreach-循环"><a href="#foreach-循环" class="header-anchor">#</a> <strong>forEach 循环</strong></h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;company&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> db<span class="token punctuation">.</span>workmet<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
result<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">printjson</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>以上两种方法均可打印，自行挑选</p> <h2 id="_15-索引-构造百万级数据"><a href="#_15-索引-构造百万级数据" class="header-anchor">#</a> 15.索引:构造百万级数据</h2> <h5 id="制作随机数方法"><a href="#制作随机数方法" class="header-anchor">#</a> <strong>制作随机数方法</strong></h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//生成随机数</span>
<span class="token keyword">function</span> <span class="token function">GetRandomNum</span><span class="token punctuation">(</span><span class="token parameter">min<span class="token punctuation">,</span> max</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> range <span class="token operator">=</span> max <span class="token operator">-</span> min<span class="token punctuation">;</span> <span class="token comment">//得到随机数区间</span>
  <span class="token keyword">let</span> rand <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//得到随机值</span>
  <span class="token keyword">return</span> min <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>rand <span class="token operator">*</span> range<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//最小值+随机数取整</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">GetRandomNum</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">99999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="制作随机用户名"><a href="#制作随机用户名" class="header-anchor">#</a> <strong>制作随机用户名</strong></h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//生成随机用户名</span>
<span class="token keyword">function</span> <span class="token function">GetRadomUserName</span><span class="token punctuation">(</span><span class="token parameter">min<span class="token punctuation">,</span> max</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> tempStringArray <span class="token operator">=</span> <span class="token string">&quot;123456789qwertyuiopasdfghjklzxcvbnm&quot;</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//构造生成时的字母库数组</span>
  <span class="token keyword">let</span> outPuttext <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token comment">//最后输出的变量</span>
  <span class="token comment">//进行循环，随机生产用户名的长度，这里需要生成随机数方法的配合</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">GetRandomNum</span><span class="token punctuation">(</span>min<span class="token punctuation">,</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//随机抽取字母，拼装成需要的用户名</span>
    outPuttext <span class="token operator">=</span>
      outPuttext <span class="token operator">+</span> tempStringArray<span class="token punctuation">[</span><span class="token function">GetRandomNum</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> tempStringArray<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> outPuttext<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h5 id="插入-20-万数据"><a href="#插入-20-万数据" class="header-anchor">#</a> <strong>插入 20 万数据</strong></h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getRander</span><span class="token punctuation">(</span><span class="token parameter">min<span class="token punctuation">,</span> max</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> range <span class="token operator">=</span> max <span class="token operator">-</span> min<span class="token punctuation">;</span>
  <span class="token keyword">let</span> rand <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> min <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>rand <span class="token operator">*</span> range<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//生成随机用户名</span>
<span class="token keyword">function</span> <span class="token function">GetRadomUserName</span><span class="token punctuation">(</span><span class="token parameter">min<span class="token punctuation">,</span> max</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> tempStringArray <span class="token operator">=</span> <span class="token string">&quot;123456789qwertyuiopasdfghjklzxcvbnm&quot;</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//构造生成时的字母库数组</span>
  <span class="token keyword">let</span> outPuttext <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token comment">//最后输出的变量</span>
  <span class="token comment">//进行循环，随机生产用户名的长度，这里需要生成随机数方法的配合</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">getRander</span><span class="token punctuation">(</span>min<span class="token punctuation">,</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//随机抽取字母，拼装成需要的用户名</span>
    outPuttext <span class="token operator">=</span>
      outPuttext <span class="token operator">+</span> tempStringArray<span class="token punctuation">[</span><span class="token function">getRander</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> tempStringArray<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> outPuttext<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// console.log(GetRadomUserName(7, 16));</span>

<span class="token keyword">var</span> startTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;company&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">200000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    userName<span class="token operator">:</span> <span class="token function">GetRadomUserName</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    randTime<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    rand0<span class="token operator">:</span> <span class="token function">getRander</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">99999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    rand1<span class="token operator">:</span> <span class="token function">getRander</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">99999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    rand2<span class="token operator">:</span> <span class="token function">getRander</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">99999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    rand3<span class="token operator">:</span> <span class="token function">getRander</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">99999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    rand4<span class="token operator">:</span> <span class="token function">getRander</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">99999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    rand5<span class="token operator">:</span> <span class="token function">getRander</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">99999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    rand6<span class="token operator">:</span> <span class="token function">getRander</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">99999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    rand7<span class="token operator">:</span> <span class="token function">getRander</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">99999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    rand8<span class="token operator">:</span> <span class="token function">getRander</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">99999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    rand9<span class="token operator">:</span> <span class="token function">getRander</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">99999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
db<span class="token punctuation">.</span>randInfo<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> endTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;demo------&gt;&quot;</span> <span class="token operator">+</span> endTime <span class="token operator">+</span> <span class="token string">&quot;ms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>插入完成后,可以使用 db.randInfo.stats() 这个命令查看数据中的数据条数(count)。</p> <h2 id="_16-索引：索引入门"><a href="#_16-索引：索引入门" class="header-anchor">#</a> 16.索引：索引入门</h2> <h5 id="普通查询性能"><a href="#普通查询性能" class="header-anchor">#</a> <strong>普通查询性能</strong></h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;company&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> startTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> re <span class="token operator">=</span> db<span class="token punctuation">.</span>randInfo<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> userName<span class="token operator">:</span> <span class="token string">&quot;4b8kzwju&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
re<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">re</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">printjson</span><span class="token punctuation">(</span>re<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> end <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;time-----&gt;&quot;</span> <span class="token operator">+</span> end <span class="token operator">+</span> <span class="token string">&quot;ms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="建立索引（ensureindex）"><a href="#建立索引（ensureindex）" class="header-anchor">#</a> <strong>建立索引</strong>（ensureIndex）</h5> <blockquote><p>代码在下面 ，值得注意的是，建立的索引一定要是 15 章节 arr 里面的键，刚开始我随便设置的键加索引，虽然成功了，但是代码上面的效率并没任何提升，例如这里是给 userName 加索引，那么这个 userName 一定不要变在下面的代码中，包括第 17 章节中的给 rand0 加索引，不要随便起名字，否则没有任何效率改变，这个坑我找了老半天了，切记~~~</p></blockquote> <h6 id="查看现有索引"><a href="#查看现有索引" class="header-anchor">#</a> 查看现有索引</h6> <div class="language- line-numbers-mode"><pre class="language-text"><code>db.randInfo.getIndexes()
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>终端的结果，现在只有一个索引值:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    v<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    key<span class="token operator">:</span> <span class="token punctuation">{</span>
      _id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&quot;_id_&quot;</span><span class="token punctuation">,</span>
    ns<span class="token operator">:</span> <span class="token string">&quot;company.randInfo&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>试着为用户名（username）建立索引。建立索引只需要一句话就可以了。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>randInfo<span class="token punctuation">.</span><span class="token function">ensureIndex</span><span class="token punctuation">(</span><span class="token punctuation">{</span> userName<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 建立索引完成后再查看 如下结果</span>
<span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    v<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    key<span class="token operator">:</span> <span class="token punctuation">{</span>
      _id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&quot;_id_&quot;</span><span class="token punctuation">,</span>
    ns<span class="token operator">:</span> <span class="token string">&quot;company.randInfo&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    v<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    key<span class="token operator">:</span> <span class="token punctuation">{</span>
      userName<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&quot;userName_1&quot;</span><span class="token punctuation">,</span>
    ns<span class="token operator">:</span> <span class="token string">&quot;company.randInfo&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><blockquote><p>无论是在关系型数据库还是文档数据库，建立索引都是非常重要的。但是索引这东西是要消耗硬盘和内存资源的，所以还是要根据程序需要进行建立了。MongoDB 也给我们进行了限制，只允许我们建立 64 个索引值。</p></blockquote> <h2 id="_17-索引：复合索引"><a href="#_17-索引：复合索引" class="header-anchor">#</a> 17.索引：复合索引</h2> <h5 id="索引中的小坑"><a href="#索引中的小坑" class="header-anchor">#</a> <strong>索引中的小坑</strong></h5> <ul><li>数据不超万条时，不需要使用索引。性能的提升并不明显，而大大增加了内存和硬盘的消耗。</li> <li>查询数据超过表数据量 30%时，不要使用索引字段查询。实际证明会比不使用索引更慢，因为它大量检索了索引表和我们原表。</li> <li>数字索引，要比字符串索引快的多，在百万级甚至千万级数据量面前，使用数字索引是个明确的选择。</li> <li>把你经常查询的数据做成一个内嵌数据（对象型的数据），然后集体进行索引。</li></ul> <h5 id="复合索引"><a href="#复合索引" class="header-anchor">#</a> <strong>复合索引</strong></h5> <p>复合索引就是两条以上的索引。16 章节已经把 username 字段建立了索引，现在把 randNum0，这个字段也设置成索引。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>randInfo<span class="token punctuation">.</span><span class="token function">ensureIndex</span><span class="token punctuation">(</span><span class="token punctuation">{</span> rand0<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>建立好后，再用查询索引状态命令进行查询。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>randInfo<span class="token punctuation">.</span><span class="token function">getIndexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这时候已经是两个自建索引了，一共有三个索引。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    v<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    key<span class="token operator">:</span> <span class="token punctuation">{</span>
      _id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&quot;_id_&quot;</span><span class="token punctuation">,</span>
    ns<span class="token operator">:</span> <span class="token string">&quot;company.randInfo&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    v<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    key<span class="token operator">:</span> <span class="token punctuation">{</span>
      userName<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&quot;userName_1&quot;</span><span class="token punctuation">,</span>
    ns<span class="token operator">:</span> <span class="token string">&quot;company.randInfo&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    v<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    key<span class="token operator">:</span> <span class="token punctuation">{</span>
      rand0<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&quot;rand0_1&quot;</span><span class="token punctuation">,</span>
    ns<span class="token operator">:</span> <span class="token string">&quot;company.randInfo&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h5 id="两个索引同时查询"><a href="#两个索引同时查询" class="header-anchor">#</a> <strong>两个索引同时查询</strong></h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;company&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> startTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> re <span class="token operator">=</span> db<span class="token punctuation">.</span>randInfo<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> userName<span class="token operator">:</span> <span class="token string">&quot;3hvx2ia&quot;</span><span class="token punctuation">,</span> rand0<span class="token operator">:</span> <span class="token number">47450</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
re<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">re</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">printjson</span><span class="token punctuation">(</span>re<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> end <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;time-----&gt;&quot;</span> <span class="token operator">+</span> end <span class="token operator">+</span> <span class="token string">&quot;ms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="指定索引查询（hint）"><a href="#指定索引查询（hint）" class="header-anchor">#</a> <strong>指定索引查询（hint）</strong></h5> <p>上面提到数字的索引要比字符串的索引快，这就需要一个方法来打破索引表的查询顺序，用我们自己指定的索引优先查询，这个方法就是 hint().</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> re <span class="token operator">=</span> db<span class="token punctuation">.</span>randInfo
  <span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> userName<span class="token operator">:</span> <span class="token string">&quot;3hvx2ia&quot;</span><span class="token punctuation">,</span> rand0<span class="token operator">:</span> <span class="token number">47450</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">hint</span><span class="token punctuation">(</span><span class="token punctuation">{</span> rand0<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 代表 true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="删除索引"><a href="#删除索引" class="header-anchor">#</a> <strong>删除索引</strong></h5> <p>当索引性能不佳或起不到作用时，需要删除索引，删除索引的命令是 dropIndex().</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>randInfo<span class="token punctuation">.</span><span class="token function">dropIndex</span><span class="token punctuation">(</span><span class="token string">&quot;rand0_1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span> <span class="token comment">//通过这个命令db.randInfo.getIndexes()  查看应该删除的名字</span>
  <span class="token punctuation">(</span><span class="token punctuation">{</span>
    v<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    key<span class="token operator">:</span> <span class="token punctuation">{</span>
      _id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&quot;_id_&quot;</span><span class="token punctuation">,</span>
    ns<span class="token operator">:</span> <span class="token string">&quot;company.randInfo&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    v<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    key<span class="token operator">:</span> <span class="token punctuation">{</span>
      userName<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&quot;userName_1&quot;</span><span class="token punctuation">,</span>
    ns<span class="token operator">:</span> <span class="token string">&quot;company.randInfo&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    v<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    key<span class="token operator">:</span> <span class="token punctuation">{</span>
      rand0<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//不是这个</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&quot;rand0_1&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 是这个名字</span>
    ns<span class="token operator">:</span> <span class="token string">&quot;company.randInfo&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p><strong><em>这里需要注意的是删除时填写的值，并不是我们的字段名称（key），而是我们索引查询表中的 name 值。这是一个小坑，希望小伙伴们不要踩中。</em></strong></p> <h2 id="_18-索引：全文索引"><a href="#_18-索引：全文索引" class="header-anchor">#</a> 18.索引：全文索引</h2> <h5 id="准备工作"><a href="#准备工作" class="header-anchor">#</a> <strong>准备工作</strong></h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 新建一个文件  建立如下代码</span>
<span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;company&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>info<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  contextInfo<span class="token operator">:</span>
    <span class="token string">&quot;I am a programmer, I love life, love family. Every day after work, I write a diary.&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>info<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  contextInfo<span class="token operator">:</span>
    <span class="token string">&quot;I am a programmer, I love PlayGame, love drink. Every day after work, I playGame and drink.&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="建立全文索引"><a href="#建立全文索引" class="header-anchor">#</a> 建立全文索引</h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>info<span class="token punctuation">.</span><span class="token function">ensureIndex</span><span class="token punctuation">(</span><span class="token punctuation">{</span> contextInfo<span class="token operator">:</span> <span class="token string">&quot;text&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="全文索引查找"><a href="#全文索引查找" class="header-anchor">#</a> <strong>全文索引查找</strong></h5> <p>查找时需要两个关键修饰符:</p> <ul><li>$text:表示要在全文索引中查东西。</li> <li>$search:后边跟查找的内容。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>info<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $text<span class="token operator">:</span> <span class="token punctuation">{</span> $search<span class="token operator">:</span> <span class="token string">&quot;programmer&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="查找多个词"><a href="#查找多个词" class="header-anchor">#</a> 查找多个词</h5> <p>全文索引是支持多个次查找的，比如希望查找数据中有 programmer，family，diary，drink 的数据（这是或的关系），所以两条数据都会出现。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>info<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $text<span class="token operator">:</span> <span class="token punctuation">{</span> $search<span class="token operator">:</span> <span class="token string">&quot;programmer family diary drink&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 或的关系  并非 和 的关系</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果这时候希望不查找出来有 drink 这个单词的记录，可以使用“-”减号来取消。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>info<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $text<span class="token operator">:</span> <span class="token punctuation">{</span> $search<span class="token operator">:</span> <span class="token string">&quot;programmer family diary -drink&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="转义符"><a href="#转义符" class="header-anchor">#</a> <strong>转义符</strong></h5> <p>全文搜索中是支持转义符的，比如我们想搜索的是两个词（love PlayGame 和 drink），这时候需要使用\斜杠来转意。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>info<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $text<span class="token operator">:</span> <span class="token punctuation">{</span> $search<span class="token operator">:</span> <span class="token string">'&quot;love PlayGame&quot; drink'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>全文索引在工作还是经常使用的，比如博客文章的搜索，长文件的关键词搜索，这些都需要使用全文索引来进行</p> <h2 id="_19-管理-用户的创建、删除与修改"><a href="#_19-管理-用户的创建、删除与修改" class="header-anchor">#</a> 19.管理:用户的创建、删除与修改</h2> <h5 id="创建用户db-createuser"><a href="#创建用户db-createuser" class="header-anchor">#</a> <strong>创建用户</strong>db.createUser</h5> <p>内置角色：</p> <ol><li>数据库用户角色：read、readWrite；</li> <li>数据库管理角色：dbAdmin、dbOwner、userAdmin;</li> <li>集群管理角色：clusterAdmin、clusterManager、clusterMonitor、hostManage；</li> <li>备份恢复角色：backup、restore；</li> <li>所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase</li> <li>超级用户角色：root</li> <li>内部角色：__system</li></ol> <p>首先要进入 admin 库中，进入方法是直接使用 use admin 就可以。进入后可以使用 show collections 来查看数据库中的集合。默认是只有一个集合的（system.version）</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  user<span class="token operator">:</span> <span class="token string">&quot;wgg&quot;</span><span class="token punctuation">,</span> <span class="token comment">//用户名</span>
  pwd<span class="token operator">:</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 密码</span>
  customData<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 有事联系</span>
    name<span class="token operator">:</span> <span class="token string">&quot;果果&quot;</span><span class="token punctuation">,</span>
    email<span class="token operator">:</span> <span class="token string">&quot;1528406176@qq.com&quot;</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  roles<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      role<span class="token operator">:</span> <span class="token string">&quot;readWrite&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 权限为读写</span>
      db<span class="token operator">:</span> <span class="token string">&quot;company&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 库</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;read&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 其他库权限为只读</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>控制台输入以上代码，会返回 Successfully added user.......表示创建成功</p> <h5 id="查找用户信息"><a href="#查找用户信息" class="header-anchor">#</a> <strong>查找用户信息</strong></h5> <p>在控制台输入：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>system<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="删除用户-不建议修改而直接删除用户"><a href="#删除用户-不建议修改而直接删除用户" class="header-anchor">#</a> <strong>删除用户</strong>(不建议修改而直接删除用户)</h5> <p>删除名利也是非常简单，直接用 remove 就可以删除这个用户的信息和权限。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>system<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user<span class="token operator">:</span> <span class="token string">&quot;wgg&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="建权"><a href="#建权" class="header-anchor">#</a> <strong>建权</strong></h5> <p>有时候我们要验证用户的用户名密码是否正确，就需要用到 MongoDB 提供的健全操作。也算是一种登录操作，不过 MongoDB 把这叫做建权。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>db.auth(&quot;wgg&quot;,&quot;123456&quot;)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果正确返回 1，如果错误返回 0。（Error：Authentication failed。）</p> <h5 id="启动建权"><a href="#启动建权" class="header-anchor">#</a> <strong>启动建权</strong></h5> <p>重启 MongoDB 服务器，然后设置必须使用建权登录。 mongod(相当于最高权限)</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mongod --auth
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>启动后，用户登录只能用用户名和密码进行登录，原来直接输入 mongo 形式链接已经不起作用,控制台如下</p> <img src="C:\Users\wang\Desktop\study\md\mongo (2).jpg" style="zoom:200%;"> <p>需要在控制台输入如下代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code> mongo <span class="token operator">-</span>u wgg <span class="token operator">-</span>p <span class="token number">123456</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">27017</span><span class="token operator">/</span>admin
<span class="token comment">// 名字  密码 ...如上</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_20-数据库的备份和还原"><a href="#_20-数据库的备份和还原" class="header-anchor">#</a> 20.数据库的备份和还原</h2> <h5 id="mongodump-参数-备份"><a href="#mongodump-参数-备份" class="header-anchor">#</a> mongodump 参数 // 备份</h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code>   <span class="token operator">--</span>host <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>  <span class="token comment">//ip地址</span>
   <span class="token operator">--</span>port <span class="token number">27017</span>    <span class="token comment">// 端口</span>
   <span class="token operator">--</span>out <span class="token constant">D</span><span class="token operator">:</span>\Shuju\backup  <span class="token comment">// 备份到哪里</span>
   <span class="token operator">--</span>collection myCollections <span class="token comment">//备份那个集合</span>
   <span class="token operator">--</span>db test   <span class="token comment">// 备份那个数据库</span>
   <span class="token operator">--</span>username username  <span class="token comment">// 用户名</span>
   <span class="token operator">--</span>password password  <span class="token comment">//密码</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在 D 盘新建文件夹 backup，重新打开终端 不需要输入 mongo，直接输入</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code> mongodump  <span class="token operator">--</span>host  <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">--</span>port <span class="token number">27017</span> <span class="token operator">--</span>out <span class="token constant">D</span><span class="token operator">:</span>\Shuju\backup   <span class="token comment">// 备份所有数据库</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>看文件夹 即可以看到备份成功</p> <h5 id="mongorestore-还原"><a href="#mongorestore-还原" class="header-anchor">#</a> mongorestore 还原</h5> <p>误删某个库还原：例如删除了 company 下面的 randInfo 这个集合，先 ctr+c 退出，再打开终端输入下面的命令</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>mongorestore  <span class="token operator">--</span>host <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>  <span class="token operator">--</span>port <span class="token number">27017</span>  <span class="token constant">D</span><span class="token operator">:</span>\Shuju\backup <span class="token comment">// 不需要加out</span>

mongorestore
      <span class="token operator">--</span>host <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
      <span class="token operator">--</span>port <span class="token number">27017</span>
      <span class="token operator">--</span>username username
      <span class="token operator">--</span>password password
      <span class="token operator">&lt;</span>path to the backup<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">5/19/2020, 7:21:45 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/wgg-blog/blog/Vue/vue.html" class="prev">
        Vue 的一些知识
      </a></span> <span class="next"><a href="/wgg-blog/blog/DB/koa.html">
        Koa2 基本学习
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/wgg-blog/assets/js/app.ca45e25c.js" defer></script><script src="/wgg-blog/assets/js/2.8fc15104.js" defer></script><script src="/wgg-blog/assets/js/12.26081e86.js" defer></script>
  </body>
</html>
